# GPU ãƒªã‚½ãƒ¼ã‚¹ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ v0.1 - è¨­å®šå¤‰æ›´ã‚¬ã‚¤ãƒ‰

## ğŸ“‹ æ¦‚è¦

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€å®Ÿéš›ã®ä½¿ç”¨ã«ãŠã„ã¦ç’°å¢ƒã«å¿œã˜ã¦å¤‰æ›´ãŒå¿…è¦ãªè¨­å®šé …ç›®ã‚’è©³ã—ãèª¬æ˜ã—ã¾ã™ã€‚

---

## ğŸ”§ å¤‰æ›´å¿…é ˆã®è¨­å®š

### 1. ã‚µãƒ¼ãƒãƒ¼è¨­å®š â­â­â­ (æœ€é‡è¦)

**ãƒ•ã‚¡ã‚¤ãƒ«**: `gpu_resource_manager_v01.py`  
**å ´æ‰€**: 18-20è¡Œç›®

```python
# ç¾åœ¨ã®è¨­å®šï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
TOTAL_SERVERS = 4        # ã‚µãƒ¼ãƒãƒ¼ç·æ•°
GPUS_PER_SERVER = 8      # å„ã‚µãƒ¼ãƒãƒ¼ã®GPUæ•°
CPUS_PER_SERVER = 64     # å„ã‚µãƒ¼ãƒãƒ¼ã®CPUæ•°
```

#### ğŸ“ å¤‰æ›´æ–¹æ³•

**ã‚·ãƒŠãƒªã‚ª1: 2å°ã®ã‚µãƒ¼ãƒãƒ¼ã€å„4GPUã€32CPU**
```python
TOTAL_SERVERS = 2        # 2ã«å¤‰æ›´
GPUS_PER_SERVER = 4      # 4ã«å¤‰æ›´
CPUS_PER_SERVER = 32     # 32ã«å¤‰æ›´
```

**ã‚·ãƒŠãƒªã‚ª2: 8å°ã®ã‚µãƒ¼ãƒãƒ¼ã€å„8GPUã€128CPU**
```python
TOTAL_SERVERS = 8        # 8ã«å¤‰æ›´
GPUS_PER_SERVER = 8      # 8ã®ã¾ã¾
CPUS_PER_SERVER = 128    # 128ã«å¤‰æ›´
```

**ã‚·ãƒŠãƒªã‚ª3: æ··åˆè¨­å®šï¼ˆç•°ãªã‚‹ã‚µãƒ¼ãƒãƒ¼æ§‹æˆï¼‰**

ã‚µãƒ¼ãƒãƒ¼æ§‹æˆãŒç•°ãªã‚‹å ´åˆã€åˆæœŸåŒ–ãƒ­ã‚¸ãƒƒã‚¯ã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

```python
# _init_resource_file() ãƒ¡ã‚½ãƒƒãƒ‰å†…ï¼ˆç´„40è¡Œç›®ï¼‰
def _init_resource_file(self):
    if not os.path.exists(self.RESOURCE_FILE):
        # å„ã‚µãƒ¼ãƒãƒ¼ã®è¨­å®šã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
        servers_config = [
            {"id": 0, "name": "gpu-server-0", "gpus": 8, "cpus": 64},
            {"id": 1, "name": "gpu-server-1", "gpus": 4, "cpus": 32},  # ä½æ§‹æˆ
            {"id": 2, "name": "gpu-server-2", "gpus": 8, "cpus": 128}, # é«˜æ§‹æˆ
        ]
        
        initial_status = {
            "servers": [
                {
                    "server_id": srv["id"],
                    "server_name": srv["name"],
                    "total_gpus": srv["gpus"],
                    "available_gpus": list(range(srv["gpus"])),
                    "total_cpus": srv["cpus"],
                    "available_cpus": srv["cpus"],
                    "running_tasks": []
                }
                for srv in servers_config
            ],
            "last_updated": datetime.now().isoformat(),
            "version": "0.1"
        }
        self._write_status(initial_status)
```

#### âœ… å¤‰æ›´ã®æ¤œè¨¼

```bash
# å¤‰æ›´å¾Œã€å†åˆæœŸåŒ–
python cli_v01.py --reset --yes

# è¨­å®šãŒæ­£ã—ã„ã‹ç¢ºèª
python cli_v01.py --status
```

---

### 2. ã‚µãƒ¼ãƒãƒ¼å‘½å â­â­

**ãƒ•ã‚¡ã‚¤ãƒ«**: `gpu_resource_manager_v01.py`  
**å ´æ‰€**: 49è¡Œç›®

```python
# ç¾åœ¨ã®å‘½å
"server_name": f"gpu-server-{i}"
# çµæœï¼šgpu-server-0, gpu-server-1, gpu-server-2, gpu-server-3
```

#### ğŸ“ å¤‰æ›´æ–¹æ³•

**æ–¹æ³•1: å®Ÿéš›ã®ãƒ›ã‚¹ãƒˆåã‚’ä½¿ç”¨**
```python
# ã‚µãƒ¼ãƒãƒ¼ãŒï¼šnode01, node02, node03, node04 ã®å ´åˆ
"server_name": f"node{i+1:02d}"
# çµæœï¼šnode01, node02, node03, node04
```

**æ–¹æ³•2: IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½¿ç”¨**
```python
# IPã§è­˜åˆ¥ã™ã‚‹å ´åˆ
server_ips = ["192.168.1.11", "192.168.1.12", "192.168.1.13", "192.168.1.14"]
"server_name": server_ips[i]
```

**æ–¹æ³•3: ã‚«ã‚¹ã‚¿ãƒ å**
```python
server_names = ["training-01", "inference-02", "research-03", "backup-04"]
"server_name": server_names[i]
```

---

### 3. ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ â­â­

**ãƒ•ã‚¡ã‚¤ãƒ«**: `gpu_resource_manager_v01.py`  
**å ´æ‰€**: 24-25è¡Œç›®

```python
# ç¾åœ¨ã®ãƒ‘ã‚¹ï¼ˆã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰
RESOURCE_FILE = "resource_status.json"
LOCK_FILE = ".resource.lock"
```

#### ğŸ“ å¤‰æ›´æ–¹æ³•

**ã‚·ãƒŠãƒªã‚ª1: çµ¶å¯¾ãƒ‘ã‚¹ã‚’æŒ‡å®šï¼ˆæœ¬ç•ªç’°å¢ƒæ¨å¥¨ï¼‰**
```python
import os

# å›ºå®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½¿ç”¨
DATA_DIR = "/var/lib/gpu_manager"  # Linux
# ã¾ãŸã¯
DATA_DIR = "C:\\ProgramData\\GPUManager"  # Windows

RESOURCE_FILE = os.path.join(DATA_DIR, "resource_status.json")
LOCK_FILE = os.path.join(DATA_DIR, ".resource.lock")

# __init__ ã§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
def __init__(self):
    os.makedirs(DATA_DIR, exist_ok=True)
    self._init_resource_file()
```

**ã‚·ãƒŠãƒªã‚ª2: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ›ãƒ¼ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½¿ç”¨**
```python
from pathlib import Path

HOME_DIR = Path.home() / ".gpu_manager"
HOME_DIR.mkdir(exist_ok=True)

RESOURCE_FILE = str(HOME_DIR / "resource_status.json")
LOCK_FILE = str(HOME_DIR / ".resource.lock")
```

**ã‚·ãƒŠãƒªã‚ª3: ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½¿ç”¨**
```python
import tempfile

TMP_DIR = tempfile.gettempdir()
RESOURCE_FILE = os.path.join(TMP_DIR, "gpu_resource_status.json")
LOCK_FILE = os.path.join(TMP_DIR, ".gpu_resource.lock")
```

---

### 4. ãƒ­ãƒƒã‚¯ãƒ¡ã‚«ãƒ‹ã‚ºãƒ  (Windowsãƒ¦ãƒ¼ã‚¶ãƒ¼) â­â­â­

**å•é¡Œ**: Windowsã¯ `fcntl` ãƒ¢ã‚¸ãƒ¥ãƒ«ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“

**ãƒ•ã‚¡ã‚¤ãƒ«**: `gpu_resource_manager_v01.py`  
**å ´æ‰€**: 7è¡Œç›®ã¨75-96è¡Œç›®

#### ğŸ“ å¤‰æ›´æ–¹æ³•

**æ–¹æ³•1: `msvcrt` ã‚’ä½¿ç”¨ï¼ˆWindowsï¼‰**

```python
# ãƒ•ã‚¡ã‚¤ãƒ«ã®å…ˆé ­
import sys
if sys.platform == 'win32':
    import msvcrt
else:
    import fcntl

# _acquire_lock ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å¤‰æ›´
def _acquire_lock(self, timeout: int = 60) -> Optional[object]:
    """ãƒ•ã‚¡ã‚¤ãƒ«ãƒ­ãƒƒã‚¯ã‚’å–å¾—ï¼ˆWindowså¯¾å¿œï¼‰"""
    lock_file = open(self.LOCK_FILE, 'w')
    start_time = time.time()
    
    while time.time() - start_time < timeout:
        try:
            if sys.platform == 'win32':
                # Windows
                msvcrt.locking(lock_file.fileno(), msvcrt.LK_NBLCK, 1)
            else:
                # Linux/Unix
                fcntl.flock(lock_file.fileno(), fcntl.LOCK_EX | fcntl.LOCK_NB)
            return lock_file
        except (IOError, OSError):
            time.sleep(0.1)
    
    lock_file.close()
    return None

def _release_lock(self, lock_file: object):
    """ãƒ•ã‚¡ã‚¤ãƒ«ãƒ­ãƒƒã‚¯ã‚’è§£æ”¾ï¼ˆWindowså¯¾å¿œï¼‰"""
    if lock_file:
        try:
            if sys.platform == 'win32':
                msvcrt.locking(lock_file.fileno(), msvcrt.LK_UNLCK, 1)
            else:
                fcntl.flock(lock_file.fileno(), fcntl.LOCK_UN)
            lock_file.close()
        except Exception as e:
            print(f"âš  ãƒ­ãƒƒã‚¯è§£æ”¾æ™‚ã«ã‚¨ãƒ©ãƒ¼: {e}")
```

**æ–¹æ³•2: `filelock` ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ï¼ˆã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã€æ¨å¥¨ï¼‰**

```bash
# ã¾ãšã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install filelock
```

```python
# ãƒ•ã‚¡ã‚¤ãƒ«ã®å…ˆé ­
from filelock import FileLock, Timeout

# _acquire_lock ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å¤‰æ›´
def _acquire_lock(self, timeout: int = 60) -> Optional[object]:
    """ãƒ•ã‚¡ã‚¤ãƒ«ãƒ­ãƒƒã‚¯ã‚’å–å¾—ï¼ˆfilelockã‚’ä½¿ç”¨ã€ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ï¼‰"""
    try:
        lock = FileLock(self.LOCK_FILE, timeout=timeout)
        lock.acquire()
        return lock
    except Timeout:
        return None

def _release_lock(self, lock_file: object):
    """ãƒ•ã‚¡ã‚¤ãƒ«ãƒ­ãƒƒã‚¯ã‚’è§£æ”¾"""
    if lock_file:
        try:
            lock_file.release()
        except Exception as e:
            print(f"âš  ãƒ­ãƒƒã‚¯è§£æ”¾æ™‚ã«ã‚¨ãƒ©ãƒ¼: {e}")
```

**æ–¹æ³•3: ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ•ãƒ©ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ãƒ­ãƒƒã‚¯ï¼ˆéæ¨å¥¨ã ãŒæœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ï¼‰**

```python
def _acquire_lock(self, timeout: int = 60) -> Optional[object]:
    """ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ•ãƒ©ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ãƒ­ãƒƒã‚¯"""
    start_time = time.time()
    
    while time.time() - start_time < timeout:
        try:
            # ãƒ­ãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆã‚’è©¦è¡Œï¼ˆæ’ä»–ãƒ¢ãƒ¼ãƒ‰ï¼‰
            fd = os.open(self.LOCK_FILE, os.O_CREAT | os.O_EXCL | os.O_WRONLY)
            return fd
        except FileExistsError:
            time.sleep(0.1)
    
    return None

def _release_lock(self, lock_file: object):
    """ãƒ•ãƒ©ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ãƒ­ãƒƒã‚¯ã‚’è§£æ”¾"""
    if lock_file:
        try:
            os.close(lock_file)
            os.remove(self.LOCK_FILE)
        except Exception as e:
            print(f"âš  ãƒ­ãƒƒã‚¯è§£æ”¾æ™‚ã«ã‚¨ãƒ©ãƒ¼: {e}")
```

---

## ğŸ”§ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®è¨­å®šå¤‰æ›´

### 5. GPUæ•°åˆ¶é™ â­

**ãƒ•ã‚¡ã‚¤ãƒ«**: `gpu_resource_manager_v01.py`  
**å ´æ‰€**: 123-126è¡Œç›®

```python
# ç¾åœ¨ã®åˆ¶é™
if not (2 <= required_gpus <= 8):
    raise ValueError(f"GPUæ•°ã¯2-8ã®é–“ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€ç¾åœ¨å€¤: {required_gpus}")
```

#### ğŸ“ å¤‰æ›´æ–¹æ³•

**ã‚·ãƒŠãƒªã‚ª1: ã‚·ãƒ³ã‚°ãƒ«GPUã‚¿ã‚¹ã‚¯ã‚’è¨±å¯**
```python
if not (1 <= required_gpus <= 8):
    raise ValueError(f"GPUæ•°ã¯1-8ã®é–“ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€ç¾åœ¨å€¤: {required_gpus}")
```

**ã‚·ãƒŠãƒªã‚ª2: ã‚µãƒ¼ãƒãƒ¼æ§‹æˆã«åŸºã¥ã„ã¦ä¸Šé™ã‚’èª¿æ•´**
```python
# ã‚µãƒ¼ãƒãƒ¼ã«16GPU ãŒã‚ã‚‹å ´åˆ
if not (1 <= required_gpus <= 16):
    raise ValueError(f"GPUæ•°ã¯1-16ã®é–“ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€ç¾åœ¨å€¤: {required_gpus}")

# ã¾ãŸã¯è¨­å®šå€¤ã‚’ä½¿ç”¨
if not (1 <= required_gpus <= self.GPUS_PER_SERVER):
    raise ValueError(f"GPUæ•°ã¯1-{self.GPUS_PER_SERVER}ã®é–“ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™")
```

**ã‚·ãƒŠãƒªã‚ª3: åˆ¶é™ã‚’è§£é™¤**
```python
# ä¸‹é™ã‚’å®Œå…¨ã«è§£é™¤ï¼ˆéæ¨å¥¨ï¼‰
if required_gpus < 1 or required_gpus > self.GPUS_PER_SERVER:
    raise ValueError(f"GPUæ•°ã¯1-{self.GPUS_PER_SERVER}ã®é–“ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™")
```

---

### 6. ãƒ­ãƒƒã‚¯ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“ â­

**ãƒ•ã‚¡ã‚¤ãƒ«**: `gpu_resource_manager_v01.py`  
**å ´æ‰€**: è¤‡æ•°ç®‡æ‰€ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ60ç§’ï¼‰

```python
# ç¾åœ¨ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
def _acquire_lock(self, timeout: int = 60):  # 60ç§’
```

#### ğŸ“ å¤‰æ›´æ–¹æ³•

**ã‚·ãƒŠãƒªã‚ª1: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“ã‚’çŸ­ç¸®ï¼ˆé«˜é€Ÿå¤±æ•—ï¼‰**
```python
def _acquire_lock(self, timeout: int = 10):  # 10ç§’ã«å¤‰æ›´
```

**ã‚·ãƒŠãƒªã‚ª2: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“ã‚’å»¶é•·ï¼ˆã‚ˆã‚Šå¿è€å¼·ãå¾…æ©Ÿï¼‰**
```python
def _acquire_lock(self, timeout: int = 300):  # 5åˆ†ã«å¤‰æ›´
```

**ã‚·ãƒŠãƒªã‚ª3: è¨­å®šå®šæ•°ã‚’ä½¿ç”¨**
```python
# ã‚¯ãƒ©ã‚¹ã®å…ˆé ­ã§å®šç¾©
class GPUResourceManagerV01:
    LOCK_TIMEOUT = 60  # çµ±ä¸€ã—ã¦å¤‰æ›´å¯èƒ½
    
    def _acquire_lock(self, timeout: int = None):
        if timeout is None:
            timeout = self.LOCK_TIMEOUT
        # ...
```

---

### 7. CLIãƒ„ãƒ¼ãƒ«ã®è¡¨ç¤ºå½¢å¼ â­

**ãƒ•ã‚¡ã‚¤ãƒ«**: `cli_v01.py`  
**å ´æ‰€**: 42-50è¡Œç›®

```python
# ç¾åœ¨ã®ãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼
headers = ['ã‚µãƒ¼ãƒãƒ¼', 'GPUåˆ©ç”¨å¯/åˆè¨ˆ', 'GPUä½¿ç”¨ç‡', 'CPUåˆ©ç”¨å¯/åˆè¨ˆ', 'CPUä½¿ç”¨ç‡', 'å®Ÿè¡Œä¸­ã‚¿ã‚¹ã‚¯æ•°']
```

#### ğŸ“ å¤‰æ›´æ–¹æ³•

**ã‚·ãƒŠãƒªã‚ª1: è‹±èªã«å¤‰æ›´**
```python
headers = ['Server', 'GPU Avail/Total', 'GPU Usage', 'CPU Avail/Total', 'CPU Usage', 'Tasks']
```

**ã‚·ãƒŠãƒªã‚ª2: è¡¨ç¤ºã‚’ç°¡ç•¥åŒ–**
```python
headers = ['ã‚µãƒ¼ãƒãƒ¼', 'GPU', 'CPU', 'ã‚¿ã‚¹ã‚¯æ•°']
table_data.append([
    server['server_name'],
    f"{server['available_gpus']}/{server['total_gpus']}",
    f"{server['available_cpus']}/{server['total_cpus']}",
    server['running_tasks']
])
```

---

## ğŸ“ å®Ÿéš›ã®è¨­å®šä¾‹

### ä¾‹1: å°è¦æ¨¡ãƒ©ãƒœï¼ˆ2å°ã®ã‚µãƒ¼ãƒãƒ¼ã€å„4GPUï¼‰

```python
# gpu_resource_manager_v01.py

class GPUResourceManagerV01:
    # è¨­å®šã‚’å¤‰æ›´
    TOTAL_SERVERS = 2
    GPUS_PER_SERVER = 4
    CPUS_PER_SERVER = 32
    
    # ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’å¤‰æ›´
    RESOURCE_FILE = "/home/lab/gpu_manager/resource_status.json"
    LOCK_FILE = "/home/lab/gpu_manager/.resource.lock"
    
    def __init__(self):
        # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
        os.makedirs("/home/lab/gpu_manager", exist_ok=True)
        self._init_resource_file()
    
    def _init_resource_file(self):
        if not os.path.exists(self.RESOURCE_FILE):
            initial_status = {
                "servers": [
                    {
                        "server_id": i,
                        "server_name": f"lab-gpu-{i+1:02d}",  # lab-gpu-01, lab-gpu-02
                        "total_gpus": self.GPUS_PER_SERVER,
                        "available_gpus": list(range(self.GPUS_PER_SERVER)),
                        "total_cpus": self.CPUS_PER_SERVER,
                        "available_cpus": self.CPUS_PER_SERVER,
                        "running_tasks": []
                    }
                    for i in range(self.TOTAL_SERVERS)
                ],
                "last_updated": datetime.now().isoformat(),
                "version": "0.1-lab"
            }
            self._write_status(initial_status)
```

### ä¾‹2: ä¼æ¥­ç’°å¢ƒï¼ˆ8å°ã®ã‚µãƒ¼ãƒãƒ¼ã€æ··åˆæ§‹æˆï¼‰

```python
# gpu_resource_manager_v01.py

class GPUResourceManagerV01:
    # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨
    DATA_DIR = "/opt/gpu_manager/data"
    RESOURCE_FILE = f"{DATA_DIR}/resource_status.json"
    LOCK_FILE = f"{DATA_DIR}/.resource.lock"
    
    def __init__(self):
        os.makedirs(self.DATA_DIR, exist_ok=True)
        self._init_resource_file()
    
    def _init_resource_file(self):
        if not os.path.exists(self.RESOURCE_FILE):
            # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¿
            servers_config = [
                {"id": 0, "name": "prod-gpu-01", "ip": "10.0.1.11", "gpus": 8, "cpus": 64},
                {"id": 1, "name": "prod-gpu-02", "ip": "10.0.1.12", "gpus": 8, "cpus": 64},
                {"id": 2, "name": "prod-gpu-03", "ip": "10.0.1.13", "gpus": 8, "cpus": 64},
                {"id": 3, "name": "prod-gpu-04", "ip": "10.0.1.14", "gpus": 8, "cpus": 64},
                {"id": 4, "name": "dev-gpu-01",  "ip": "10.0.2.11", "gpus": 4, "cpus": 32},
                {"id": 5, "name": "dev-gpu-02",  "ip": "10.0.2.12", "gpus": 4, "cpus": 32},
            ]
            
            initial_status = {
                "servers": [
                    {
                        "server_id": srv["id"],
                        "server_name": srv["name"],
                        "server_ip": srv["ip"],
                        "total_gpus": srv["gpus"],
                        "available_gpus": list(range(srv["gpus"])),
                        "total_cpus": srv["cpus"],
                        "available_cpus": srv["cpus"],
                        "running_tasks": []
                    }
                    for srv in servers_config
                ],
                "last_updated": datetime.now().isoformat(),
                "version": "0.1-enterprise"
            }
            self._write_status(initial_status)
```

---

## âœ… å¤‰æ›´ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

å¤‰æ›´å®Œäº†å¾Œã€ã“ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã§æ¤œè¨¼ï¼š

### åŸºæœ¬è¨­å®š
- [ ] ã‚µãƒ¼ãƒãƒ¼æ•°ã‚’å¤‰æ›´æ¸ˆã¿
- [ ] GPUæ•°ã‚’å¤‰æ›´æ¸ˆã¿
- [ ] CPUæ•°ã‚’å¤‰æ›´æ¸ˆã¿
- [ ] ã‚µãƒ¼ãƒãƒ¼å‘½åã‚’å¤‰æ›´æ¸ˆã¿ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- [ ] ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’å¤‰æ›´æ¸ˆã¿ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

### Windowsç‰¹åˆ¥è¨­å®š
- [ ] `filelock` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã€ã¾ãŸã¯ä»–ã®ãƒ­ãƒƒã‚¯ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’ä½¿ç”¨
- [ ] ãƒ­ãƒƒã‚¯é–¢é€£ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´æ¸ˆã¿
- [ ] ãƒ­ãƒƒã‚¯æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆå®Œäº†

### æ©Ÿèƒ½æ¤œè¨¼
- [ ] åˆæœŸåŒ–æˆåŠŸ
- [ ] çŠ¶æ…‹ã‚¯ã‚¨ãƒªæ­£å¸¸
- [ ] ãƒªã‚½ãƒ¼ã‚¹å‰²ã‚Šå½“ã¦å‹•ä½œ
- [ ] ãƒªã‚½ãƒ¼ã‚¹è§£æ”¾å‹•ä½œ
- [ ] ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã«åˆæ ¼

### ãƒ†ã‚¹ãƒˆã‚³ãƒãƒ³ãƒ‰
```bash
# 1. ãƒªã‚»ãƒƒãƒˆã¨åˆæœŸåŒ–
python cli_v01.py --reset --yes

# 2. è¨­å®šã®ç¢ºèª
python cli_v01.py --status
python cli_v01.py --detail

# 3. å‰²ã‚Šå½“ã¦ã®ãƒ†ã‚¹ãƒˆ
python cli_v01.py --allocate test_001 2 16

# 4. çŠ¶æ…‹ã®æ¤œè¨¼
python cli_v01.py --status

# 5. è§£æ”¾ã®ãƒ†ã‚¹ãƒˆ
python cli_v01.py --release test_001

# 6. ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
python test_v01.py
```

---

## ğŸ› ã‚ˆãã‚ã‚‹è³ªå•

### Q1: è¨­å®šã‚’å¤‰æ›´ã—ãŸãŒçŠ¶æ…‹ãŒæ­£ã—ããªã„ï¼Ÿ

**A**: ã‚·ã‚¹ãƒ†ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
```bash
python cli_v01.py --reset --yes
```

### Q2: Windowsã§"No module named 'fcntl'"ã‚¨ãƒ©ãƒ¼ï¼Ÿ

**A**: ã‚»ã‚¯ã‚·ãƒ§ãƒ³4ã«å¾“ã£ã¦ãƒ­ãƒƒã‚¯ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’å¤‰æ›´ã—ã€filelockã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„

### Q3: ã‚µãƒ¼ãƒãƒ¼æ•°ã‚’å¤‰æ›´ã—ãŸã‚‰ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ï¼Ÿ

**A**: ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã«4å°ã®ã‚µãƒ¼ãƒãƒ¼ãŒãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã™ã€‚test_v01.py ã®ãƒ†ã‚¹ãƒˆã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™

### Q4: å¤‰æ›´ãŒæ­£ã—ã„ã‹æ¤œè¨¼ã™ã‚‹æ–¹æ³•ã¯ï¼Ÿ

**A**: 
```bash
# è©³ç´°ãªçŠ¶æ…‹ã‚’ç¢ºèªã—ã€è¨­å®šã‚’ãƒã‚§ãƒƒã‚¯
python cli_v01.py --detail

# ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
python test_v01.py
```

---

## ğŸ“‹ ã‚¯ã‚¤ãƒƒã‚¯å¤‰æ›´ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

### ã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¦å¤‰æ›´ã—ã¦ãã ã•ã„

```python
# gpu_resource_manager_v01.py

# ============ å¤‰æ›´å¿…é ˆ ============
TOTAL_SERVERS = 4        # TODO: ã‚µãƒ¼ãƒãƒ¼æ•°ã«å¤‰æ›´
GPUS_PER_SERVER = 8      # TODO: GPUæ•°ã«å¤‰æ›´
CPUS_PER_SERVER = 64     # TODO: CPUæ•°ã«å¤‰æ›´

# ============ ã‚ªãƒ—ã‚·ãƒ§ãƒ³å¤‰æ›´ ============
# ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
RESOURCE_FILE = "resource_status.json"  # TODO: å¸Œæœ›ã®ãƒ‘ã‚¹ã«å¤‰æ›´
LOCK_FILE = ".resource.lock"            # TODO: å¸Œæœ›ã®ãƒ‘ã‚¹ã«å¤‰æ›´

# ã‚µãƒ¼ãƒãƒ¼å‘½åï¼ˆ_init_resource_file å†…ï¼‰
"server_name": f"gpu-server-{i}"  # TODO: å‘½åè¦å‰‡ã«å¤‰æ›´

# GPUæ•°åˆ¶é™ï¼ˆallocate_resources å†…ï¼‰
if not (2 <= required_gpus <= 8):  # TODO: åˆ¶é™ç¯„å›²ã‚’èª¿æ•´

# ãƒ­ãƒƒã‚¯ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“
def _acquire_lock(self, timeout: int = 60):  # TODO: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“ã‚’èª¿æ•´
```

---

## ğŸ“ ã‚µãƒãƒ¼ãƒˆãŒå¿…è¦ã§ã™ã‹ï¼Ÿ

å¤‰æ›´ä¸­ã«å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆï¼š

1. ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª
2. æœ¬ã‚¬ã‚¤ãƒ‰ã®é–¢é€£ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§
3. `python cli_v01.py --detail` ã§çŠ¶æ…‹ã‚’ç¢ºèª
4. `python cli_v01.py --reset --yes` ã§ãƒªã‚»ãƒƒãƒˆã‚’è©¦è¡Œ

---

**å¤‰æ›´å®Œäº†å¾Œã¯ã€å®Œå…¨ãªãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦æ©Ÿèƒ½ãŒæ­£å¸¸ã§ã‚ã‚‹ã“ã¨ã‚’æ¤œè¨¼ã—ã¦ãã ã•ã„ï¼** âœ…

