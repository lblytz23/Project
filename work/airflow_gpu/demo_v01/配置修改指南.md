# GPUèµ„æºç®¡ç†å™¨ v0.1 - é…ç½®ä¿®æ”¹æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜åœ¨å®é™…ä½¿ç”¨ä¸­éœ€è¦æ ¹æ®ä½ çš„ç¯å¢ƒä¿®æ”¹çš„é…ç½®é¡¹ã€‚

---

## ğŸ”§ å¿…é¡»ä¿®æ”¹çš„é…ç½®

### 1. æœåŠ¡å™¨é…ç½® â­â­â­ (æœ€é‡è¦)

**æ–‡ä»¶**: `gpu_resource_manager_v01.py`  
**ä½ç½®**: ç¬¬18-20è¡Œ

```python
# å½“å‰é…ç½®ï¼ˆé»˜è®¤ï¼‰
TOTAL_SERVERS = 4        # æœåŠ¡å™¨æ€»æ•°
GPUS_PER_SERVER = 8      # æ¯å°æœåŠ¡å™¨çš„GPUæ•°é‡
CPUS_PER_SERVER = 64     # æ¯å°æœåŠ¡å™¨çš„CPUæ•°é‡
```

#### ğŸ“ ä¿®æ”¹æ–¹æ³•

**åœºæ™¯1: ä½ æœ‰2å°æœåŠ¡å™¨ï¼Œæ¯å°4ä¸ªGPUï¼Œ32ä¸ªCPU**
```python
TOTAL_SERVERS = 2        # æ”¹ä¸º 2
GPUS_PER_SERVER = 4      # æ”¹ä¸º 4
CPUS_PER_SERVER = 32     # æ”¹ä¸º 32
```

**åœºæ™¯2: ä½ æœ‰8å°æœåŠ¡å™¨ï¼Œæ¯å°8ä¸ªGPUï¼Œ128ä¸ªCPU**
```python
TOTAL_SERVERS = 8        # æ”¹ä¸º 8
GPUS_PER_SERVER = 8      # ä¿æŒ 8
CPUS_PER_SERVER = 128    # æ”¹ä¸º 128
```

**åœºæ™¯3: æ··åˆé…ç½®ï¼ˆä¸åŒæœåŠ¡å™¨ä¸åŒé…ç½®ï¼‰**

å¦‚æœä½ çš„æœåŠ¡å™¨é…ç½®ä¸åŒï¼Œéœ€è¦ä¿®æ”¹åˆå§‹åŒ–é€»è¾‘ï¼š

```python
# åœ¨ _init_resource_file() æ–¹æ³•ä¸­ï¼ˆçº¦ç¬¬40è¡Œï¼‰
def _init_resource_file(self):
    if not os.path.exists(self.RESOURCE_FILE):
        # è‡ªå®šä¹‰æ¯å°æœåŠ¡å™¨çš„é…ç½®
        servers_config = [
            {"id": 0, "name": "gpu-server-0", "gpus": 8, "cpus": 64},
            {"id": 1, "name": "gpu-server-1", "gpus": 4, "cpus": 32},  # é…ç½®è¾ƒä½
            {"id": 2, "name": "gpu-server-2", "gpus": 8, "cpus": 128}, # é…ç½®è¾ƒé«˜
        ]
        
        initial_status = {
            "servers": [
                {
                    "server_id": srv["id"],
                    "server_name": srv["name"],
                    "total_gpus": srv["gpus"],
                    "available_gpus": list(range(srv["gpus"])),
                    "total_cpus": srv["cpus"],
                    "available_cpus": srv["cpus"],
                    "running_tasks": []
                }
                for srv in servers_config
            ],
            "last_updated": datetime.now().isoformat(),
            "version": "0.1"
        }
        self._write_status(initial_status)
```

#### âœ… éªŒè¯ä¿®æ”¹

```bash
# ä¿®æ”¹åï¼Œé‡æ–°åˆå§‹åŒ–
python cli_v01.py --reset --yes

# æŸ¥çœ‹é…ç½®æ˜¯å¦æ­£ç¡®
python cli_v01.py --status
```

---

### 2. æœåŠ¡å™¨å‘½å â­â­

**æ–‡ä»¶**: `gpu_resource_manager_v01.py`  
**ä½ç½®**: ç¬¬49è¡Œ

```python
# å½“å‰å‘½å
"server_name": f"gpu-server-{i}"
# ç»“æœï¼šgpu-server-0, gpu-server-1, gpu-server-2, gpu-server-3
```

#### ğŸ“ ä¿®æ”¹æ–¹æ³•

**æ–¹å¼1: ä½¿ç”¨å®é™…ä¸»æœºå**
```python
# å¦‚æœä½ çš„æœåŠ¡å™¨æ˜¯ï¼šnode01, node02, node03, node04
"server_name": f"node{i+1:02d}"
# ç»“æœï¼šnode01, node02, node03, node04
```

**æ–¹å¼2: ä½¿ç”¨IPåœ°å€**
```python
# å¦‚æœä½ æƒ³ç”¨IPæ ‡è¯†
server_ips = ["192.168.1.11", "192.168.1.12", "192.168.1.13", "192.168.1.14"]
"server_name": server_ips[i]
```

**æ–¹å¼3: è‡ªå®šä¹‰åç§°**
```python
server_names = ["training-01", "inference-02", "research-03", "backup-04"]
"server_name": server_names[i]
```

---

### 3. æ–‡ä»¶è·¯å¾„ â­â­

**æ–‡ä»¶**: `gpu_resource_manager_v01.py`  
**ä½ç½®**: ç¬¬24-25è¡Œ

```python
# å½“å‰è·¯å¾„ï¼ˆå½“å‰ç›®å½•ï¼‰
RESOURCE_FILE = "resource_status.json"
LOCK_FILE = ".resource.lock"
```

#### ğŸ“ ä¿®æ”¹æ–¹æ³•

**åœºæ™¯1: æŒ‡å®šç»å¯¹è·¯å¾„ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰**
```python
import os

# ä½¿ç”¨å›ºå®šç›®å½•
DATA_DIR = "/var/lib/gpu_manager"  # Linux
# æˆ–
DATA_DIR = "C:\\ProgramData\\GPUManager"  # Windows

RESOURCE_FILE = os.path.join(DATA_DIR, "resource_status.json")
LOCK_FILE = os.path.join(DATA_DIR, ".resource.lock")

# éœ€è¦åœ¨ __init__ ä¸­åˆ›å»ºç›®å½•
def __init__(self):
    os.makedirs(DATA_DIR, exist_ok=True)
    self._init_resource_file()
```

**åœºæ™¯2: ä½¿ç”¨ç”¨æˆ·ä¸»ç›®å½•**
```python
from pathlib import Path

HOME_DIR = Path.home() / ".gpu_manager"
HOME_DIR.mkdir(exist_ok=True)

RESOURCE_FILE = str(HOME_DIR / "resource_status.json")
LOCK_FILE = str(HOME_DIR / ".resource.lock")
```

**åœºæ™¯3: ä½¿ç”¨ä¸´æ—¶ç›®å½•**
```python
import tempfile

TMP_DIR = tempfile.gettempdir()
RESOURCE_FILE = os.path.join(TMP_DIR, "gpu_resource_status.json")
LOCK_FILE = os.path.join(TMP_DIR, ".gpu_resource.lock")
```

---

### 4. é”æœºåˆ¶ (Windowsç”¨æˆ·) â­â­â­

**é—®é¢˜**: Windowsä¸æ”¯æŒ `fcntl` æ¨¡å—

**æ–‡ä»¶**: `gpu_resource_manager_v01.py`  
**ä½ç½®**: ç¬¬7è¡Œå’Œç¬¬75-96è¡Œ

#### ğŸ“ ä¿®æ”¹æ–¹æ³•

**æ–¹å¼1: ä½¿ç”¨ `msvcrt` (Windows)**

```python
# åœ¨æ–‡ä»¶å¼€å¤´
import sys
if sys.platform == 'win32':
    import msvcrt
else:
    import fcntl

# ä¿®æ”¹ _acquire_lock æ–¹æ³•
def _acquire_lock(self, timeout: int = 60) -> Optional[object]:
    """è·å–æ–‡ä»¶é”ï¼ˆæ”¯æŒWindowsï¼‰"""
    lock_file = open(self.LOCK_FILE, 'w')
    start_time = time.time()
    
    while time.time() - start_time < timeout:
        try:
            if sys.platform == 'win32':
                # Windows
                msvcrt.locking(lock_file.fileno(), msvcrt.LK_NBLCK, 1)
            else:
                # Linux/Unix
                fcntl.flock(lock_file.fileno(), fcntl.LOCK_EX | fcntl.LOCK_NB)
            return lock_file
        except (IOError, OSError):
            time.sleep(0.1)
    
    lock_file.close()
    return None

def _release_lock(self, lock_file: object):
    """é‡Šæ”¾æ–‡ä»¶é”ï¼ˆæ”¯æŒWindowsï¼‰"""
    if lock_file:
        try:
            if sys.platform == 'win32':
                msvcrt.locking(lock_file.fileno(), msvcrt.LK_UNLCK, 1)
            else:
                fcntl.flock(lock_file.fileno(), fcntl.LOCK_UN)
            lock_file.close()
        except Exception as e:
            print(f"âš  é‡Šæ”¾é”æ—¶å‡ºé”™: {e}")
```

**æ–¹å¼2: ä½¿ç”¨ `filelock` åº“ï¼ˆè·¨å¹³å°ï¼Œæ¨èï¼‰**

```bash
# å…ˆå®‰è£…
pip install filelock
```

```python
# åœ¨æ–‡ä»¶å¼€å¤´
from filelock import FileLock, Timeout

# ä¿®æ”¹ _acquire_lock æ–¹æ³•
def _acquire_lock(self, timeout: int = 60) -> Optional[object]:
    """è·å–æ–‡ä»¶é”ï¼ˆä½¿ç”¨filelockï¼Œè·¨å¹³å°ï¼‰"""
    try:
        lock = FileLock(self.LOCK_FILE, timeout=timeout)
        lock.acquire()
        return lock
    except Timeout:
        return None

def _release_lock(self, lock_file: object):
    """é‡Šæ”¾æ–‡ä»¶é”"""
    if lock_file:
        try:
            lock_file.release()
        except Exception as e:
            print(f"âš  é‡Šæ”¾é”æ—¶å‡ºé”™: {e}")
```

**æ–¹å¼3: ç®€å•çš„æ ‡å¿—æ–‡ä»¶é”ï¼ˆä¸æ¨èï¼Œä½†æœ€ç®€å•ï¼‰**

```python
def _acquire_lock(self, timeout: int = 60) -> Optional[object]:
    """ç®€å•çš„æ ‡å¿—æ–‡ä»¶é”"""
    start_time = time.time()
    
    while time.time() - start_time < timeout:
        try:
            # å°è¯•åˆ›å»ºé”æ–‡ä»¶ï¼ˆç‹¬å æ¨¡å¼ï¼‰
            fd = os.open(self.LOCK_FILE, os.O_CREAT | os.O_EXCL | os.O_WRONLY)
            return fd
        except FileExistsError:
            time.sleep(0.1)
    
    return None

def _release_lock(self, lock_file: object):
    """é‡Šæ”¾æ ‡å¿—æ–‡ä»¶é”"""
    if lock_file:
        try:
            os.close(lock_file)
            os.remove(self.LOCK_FILE)
        except Exception as e:
            print(f"âš  é‡Šæ”¾é”æ—¶å‡ºé”™: {e}")
```

---

## ğŸ”§ å¯é€‰ä¿®æ”¹çš„é…ç½®

### 5. GPUæ•°é‡é™åˆ¶ â­

**æ–‡ä»¶**: `gpu_resource_manager_v01.py`  
**ä½ç½®**: ç¬¬123-126è¡Œ

```python
# å½“å‰é™åˆ¶
if not (2 <= required_gpus <= 8):
    raise ValueError(f"GPUæ•°é‡å¿…é¡»åœ¨2-8ä¹‹é—´ï¼Œå½“å‰å€¼: {required_gpus}")
```

#### ğŸ“ ä¿®æ”¹æ–¹æ³•

**åœºæ™¯1: å…è®¸å•GPUä»»åŠ¡**
```python
if not (1 <= required_gpus <= 8):
    raise ValueError(f"GPUæ•°é‡å¿…é¡»åœ¨1-8ä¹‹é—´ï¼Œå½“å‰å€¼: {required_gpus}")
```

**åœºæ™¯2: æ ¹æ®ä½ çš„æœåŠ¡å™¨é…ç½®è°ƒæ•´ä¸Šé™**
```python
# å¦‚æœä½ çš„æœåŠ¡å™¨æœ‰16ä¸ªGPU
if not (1 <= required_gpus <= 16):
    raise ValueError(f"GPUæ•°é‡å¿…é¡»åœ¨1-16ä¹‹é—´ï¼Œå½“å‰å€¼: {required_gpus}")

# æˆ–ä½¿ç”¨é…ç½®çš„å€¼
if not (1 <= required_gpus <= self.GPUS_PER_SERVER):
    raise ValueError(f"GPUæ•°é‡å¿…é¡»åœ¨1-{self.GPUS_PER_SERVER}ä¹‹é—´")
```

**åœºæ™¯3: å–æ¶ˆé™åˆ¶**
```python
# å®Œå…¨å–æ¶ˆä¸‹é™ï¼ˆä¸æ¨èï¼‰
if required_gpus < 1 or required_gpus > self.GPUS_PER_SERVER:
    raise ValueError(f"GPUæ•°é‡å¿…é¡»åœ¨1-{self.GPUS_PER_SERVER}ä¹‹é—´")
```

---

### 6. é”è¶…æ—¶æ—¶é—´ â­

**æ–‡ä»¶**: `gpu_resource_manager_v01.py`  
**ä½ç½®**: å¤šå¤„ï¼ˆé»˜è®¤60ç§’ï¼‰

```python
# å½“å‰è¶…æ—¶
def _acquire_lock(self, timeout: int = 60):  # 60ç§’
```

#### ğŸ“ ä¿®æ”¹æ–¹æ³•

**åœºæ™¯1: å‡å°‘è¶…æ—¶æ—¶é—´ï¼ˆå¿«é€Ÿå¤±è´¥ï¼‰**
```python
def _acquire_lock(self, timeout: int = 10):  # æ”¹ä¸º10ç§’
```

**åœºæ™¯2: å¢åŠ è¶…æ—¶æ—¶é—´ï¼ˆæ›´è€å¿ƒç­‰å¾…ï¼‰**
```python
def _acquire_lock(self, timeout: int = 300):  # æ”¹ä¸º5åˆ†é’Ÿ
```

**åœºæ™¯3: ä½¿ç”¨é…ç½®å¸¸é‡**
```python
# åœ¨ç±»çš„å¼€å¤´å®šä¹‰
class GPUResourceManagerV01:
    LOCK_TIMEOUT = 60  # å¯ä»¥ç»Ÿä¸€ä¿®æ”¹
    
    def _acquire_lock(self, timeout: int = None):
        if timeout is None:
            timeout = self.LOCK_TIMEOUT
        # ...
```

---

### 7. CLIå·¥å…·æ˜¾ç¤ºæ ¼å¼ â­

**æ–‡ä»¶**: `cli_v01.py`  
**ä½ç½®**: ç¬¬42-50è¡Œ

```python
# å½“å‰è¡¨æ ¼æ ¼å¼
headers = ['æœåŠ¡å™¨', 'GPUå¯ç”¨/æ€»æ•°', 'GPUåˆ©ç”¨ç‡', 'CPUå¯ç”¨/æ€»æ•°', 'CPUåˆ©ç”¨ç‡', 'è¿è¡Œä»»åŠ¡æ•°']
```

#### ğŸ“ ä¿®æ”¹æ–¹æ³•

**åœºæ™¯1: æ”¹ä¸ºè‹±æ–‡**
```python
headers = ['Server', 'GPU Avail/Total', 'GPU Usage', 'CPU Avail/Total', 'CPU Usage', 'Tasks']
```

**åœºæ™¯2: ç®€åŒ–æ˜¾ç¤º**
```python
headers = ['æœåŠ¡å™¨', 'GPU', 'CPU', 'ä»»åŠ¡æ•°']
table_data.append([
    server['server_name'],
    f"{server['available_gpus']}/{server['total_gpus']}",
    f"{server['available_cpus']}/{server['total_cpus']}",
    server['running_tasks']
])
```

**åœºæ™¯3: æ·»åŠ æ›´å¤šä¿¡æ¯**
```python
# éœ€è¦ä¿®æ”¹summaryç»“æ„ï¼Œæ·»åŠ æ›´å¤šç»Ÿè®¡ä¿¡æ¯
```

---

## ğŸ“ å®é™…é…ç½®ç¤ºä¾‹

### ç¤ºä¾‹1: å°å‹å®éªŒå®¤ï¼ˆ2å°æœåŠ¡å™¨ï¼Œæ¯å°4GPUï¼‰

```python
# gpu_resource_manager_v01.py

class GPUResourceManagerV01:
    # ä¿®æ”¹é…ç½®
    TOTAL_SERVERS = 2
    GPUS_PER_SERVER = 4
    CPUS_PER_SERVER = 32
    
    # ä¿®æ”¹æ–‡ä»¶è·¯å¾„
    RESOURCE_FILE = "/home/lab/gpu_manager/resource_status.json"
    LOCK_FILE = "/home/lab/gpu_manager/.resource.lock"
    
    def __init__(self):
        # ç¡®ä¿ç›®å½•å­˜åœ¨
        os.makedirs("/home/lab/gpu_manager", exist_ok=True)
        self._init_resource_file()
    
    def _init_resource_file(self):
        if not os.path.exists(self.RESOURCE_FILE):
            initial_status = {
                "servers": [
                    {
                        "server_id": i,
                        "server_name": f"lab-gpu-{i+1:02d}",  # lab-gpu-01, lab-gpu-02
                        "total_gpus": self.GPUS_PER_SERVER,
                        "available_gpus": list(range(self.GPUS_PER_SERVER)),
                        "total_cpus": self.CPUS_PER_SERVER,
                        "available_cpus": self.CPUS_PER_SERVER,
                        "running_tasks": []
                    }
                    for i in range(self.TOTAL_SERVERS)
                ],
                "last_updated": datetime.now().isoformat(),
                "version": "0.1-lab"
            }
            self._write_status(initial_status)
```

### ç¤ºä¾‹2: ä¼ä¸šç¯å¢ƒï¼ˆ8å°æœåŠ¡å™¨ï¼Œæ··åˆé…ç½®ï¼‰

```python
# gpu_resource_manager_v01.py

class GPUResourceManagerV01:
    # ä½¿ç”¨é…ç½®æ–‡ä»¶
    DATA_DIR = "/opt/gpu_manager/data"
    RESOURCE_FILE = f"{DATA_DIR}/resource_status.json"
    LOCK_FILE = f"{DATA_DIR}/.resource.lock"
    
    def __init__(self):
        os.makedirs(self.DATA_DIR, exist_ok=True)
        self._init_resource_file()
    
    def _init_resource_file(self):
        if not os.path.exists(self.RESOURCE_FILE):
            # ä»é…ç½®æ–‡ä»¶è¯»å–
            servers_config = [
                {"id": 0, "name": "prod-gpu-01", "ip": "10.0.1.11", "gpus": 8, "cpus": 64},
                {"id": 1, "name": "prod-gpu-02", "ip": "10.0.1.12", "gpus": 8, "cpus": 64},
                {"id": 2, "name": "prod-gpu-03", "ip": "10.0.1.13", "gpus": 8, "cpus": 64},
                {"id": 3, "name": "prod-gpu-04", "ip": "10.0.1.14", "gpus": 8, "cpus": 64},
                {"id": 4, "name": "dev-gpu-01",  "ip": "10.0.2.11", "gpus": 4, "cpus": 32},
                {"id": 5, "name": "dev-gpu-02",  "ip": "10.0.2.12", "gpus": 4, "cpus": 32},
            ]
            
            initial_status = {
                "servers": [
                    {
                        "server_id": srv["id"],
                        "server_name": srv["name"],
                        "server_ip": srv["ip"],
                        "total_gpus": srv["gpus"],
                        "available_gpus": list(range(srv["gpus"])),
                        "total_cpus": srv["cpus"],
                        "available_cpus": srv["cpus"],
                        "running_tasks": []
                    }
                    for srv in servers_config
                ],
                "last_updated": datetime.now().isoformat(),
                "version": "0.1-enterprise"
            }
            self._write_status(initial_status)
```

### ç¤ºä¾‹3: Windowsç¯å¢ƒ

```python
# gpu_resource_manager_v01.py

import sys
import os
if sys.platform == 'win32':
    from filelock import FileLock, Timeout
else:
    import fcntl

class GPUResourceManagerV01:
    # Windowsè·¯å¾„
    DATA_DIR = "C:\\ProgramData\\GPUManager"
    RESOURCE_FILE = os.path.join(DATA_DIR, "resource_status.json")
    LOCK_FILE = os.path.join(DATA_DIR, "resource.lock")
    
    TOTAL_SERVERS = 2
    GPUS_PER_SERVER = 2  # å‡è®¾æ˜¯æ¸¸æˆGPU
    CPUS_PER_SERVER = 16
    
    def __init__(self):
        os.makedirs(self.DATA_DIR, exist_ok=True)
        self._init_resource_file()
    
    def _acquire_lock(self, timeout: int = 60):
        """ä½¿ç”¨filelockï¼ˆè·¨å¹³å°ï¼‰"""
        try:
            lock = FileLock(self.LOCK_FILE, timeout=timeout)
            lock.acquire()
            return lock
        except Timeout:
            return None
    
    def _release_lock(self, lock_file):
        if lock_file:
            try:
                lock_file.release()
            except Exception as e:
                print(f"âš  é‡Šæ”¾é”æ—¶å‡ºé”™: {e}")
```

---

## âœ… ä¿®æ”¹æ£€æŸ¥æ¸…å•

å®Œæˆä¿®æ”¹åï¼Œä½¿ç”¨æ­¤æ¸…å•éªŒè¯ï¼š

### åŸºæœ¬é…ç½®
- [ ] æœåŠ¡å™¨æ•°é‡å·²ä¿®æ”¹
- [ ] GPUæ•°é‡å·²ä¿®æ”¹
- [ ] CPUæ•°é‡å·²ä¿®æ”¹
- [ ] æœåŠ¡å™¨å‘½åå·²ä¿®æ”¹ï¼ˆå¯é€‰ï¼‰
- [ ] æ–‡ä»¶è·¯å¾„å·²ä¿®æ”¹ï¼ˆå¯é€‰ï¼‰

### Windowsç‰¹æ®Šé…ç½®
- [ ] å·²å®‰è£… `filelock` æˆ–ä½¿ç”¨å…¶ä»–é”æœºåˆ¶
- [ ] é”ç›¸å…³ä»£ç å·²ä¿®æ”¹
- [ ] æµ‹è¯•é”åŠŸèƒ½æ­£å¸¸

### åŠŸèƒ½éªŒè¯
- [ ] åˆå§‹åŒ–æˆåŠŸ
- [ ] çŠ¶æ€æŸ¥è¯¢æ­£å¸¸
- [ ] èµ„æºåˆ†é…å·¥ä½œ
- [ ] èµ„æºé‡Šæ”¾å·¥ä½œ
- [ ] æµ‹è¯•å…¨éƒ¨é€šè¿‡

### æµ‹è¯•å‘½ä»¤
```bash
# 1. é‡ç½®å¹¶åˆå§‹åŒ–
python cli_v01.py --reset --yes

# 2. æŸ¥çœ‹é…ç½®
python cli_v01.py --status
python cli_v01.py --detail

# 3. æµ‹è¯•åˆ†é…
python cli_v01.py --allocate test_001 2 16

# 4. éªŒè¯çŠ¶æ€
python cli_v01.py --status

# 5. æµ‹è¯•é‡Šæ”¾
python cli_v01.py --release test_001

# 6. è¿è¡Œå•å…ƒæµ‹è¯•
python test_v01.py
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: ä¿®æ”¹é…ç½®åï¼ŒçŠ¶æ€ä¸å¯¹ï¼Ÿ

**A**: éœ€è¦é‡ç½®ç³»ç»Ÿ
```bash
python cli_v01.py --reset --yes
```

### Q2: Windowsä¸ŠæŠ¥é”™"No module named 'fcntl'"ï¼Ÿ

**A**: æŒ‰ç…§ç¬¬4èŠ‚ä¿®æ”¹é”æœºåˆ¶ï¼Œä½¿ç”¨filelock

### Q3: ä¿®æ”¹æœåŠ¡å™¨æ•°é‡åï¼Œæµ‹è¯•å¤±è´¥ï¼Ÿ

**A**: æµ‹è¯•ç”¨ä¾‹ä¸­ç¡¬ç¼–ç äº†4å°æœåŠ¡å™¨ï¼Œéœ€è¦ä¿®æ”¹test_v01.pyä¸­çš„æµ‹è¯•

### Q4: å¦‚ä½•éªŒè¯ä¿®æ”¹æ˜¯å¦æ­£ç¡®ï¼Ÿ

**A**: 
```bash
# æŸ¥çœ‹è¯¦ç»†çŠ¶æ€ï¼Œæ£€æŸ¥é…ç½®
python cli_v01.py --detail

# è¿è¡Œæµ‹è¯•
python test_v01.py
```

---

## ğŸ“‹ å¿«é€Ÿä¿®æ”¹æ¨¡æ¿

### å¤åˆ¶æ­¤æ¨¡æ¿è¿›è¡Œä¿®æ”¹

```python
# gpu_resource_manager_v01.py

# ============ å¿…é¡»ä¿®æ”¹ ============
TOTAL_SERVERS = 4        # TODO: æ”¹ä¸ºä½ çš„æœåŠ¡å™¨æ•°é‡
GPUS_PER_SERVER = 8      # TODO: æ”¹ä¸ºä½ çš„GPUæ•°é‡
CPUS_PER_SERVER = 64     # TODO: æ”¹ä¸ºä½ çš„CPUæ•°é‡

# ============ å¯é€‰ä¿®æ”¹ ============
# æ–‡ä»¶è·¯å¾„
RESOURCE_FILE = "resource_status.json"  # TODO: æ”¹ä¸ºä½ æƒ³è¦çš„è·¯å¾„
LOCK_FILE = ".resource.lock"            # TODO: æ”¹ä¸ºä½ æƒ³è¦çš„è·¯å¾„

# æœåŠ¡å™¨å‘½åï¼ˆåœ¨_init_resource_fileä¸­ï¼‰
"server_name": f"gpu-server-{i}"  # TODO: æ”¹ä¸ºä½ çš„å‘½åè§„åˆ™

# GPUæ•°é‡é™åˆ¶ï¼ˆåœ¨allocate_resourcesä¸­ï¼‰
if not (2 <= required_gpus <= 8):  # TODO: è°ƒæ•´é™åˆ¶èŒƒå›´

# é”è¶…æ—¶æ—¶é—´
def _acquire_lock(self, timeout: int = 60):  # TODO: è°ƒæ•´è¶…æ—¶æ—¶é—´
```

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœåœ¨ä¿®æ”¹è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
2. å‚è€ƒæœ¬æŒ‡å—çš„ç›¸å…³ç« èŠ‚
3. è¿è¡Œ `python cli_v01.py --detail` æŸ¥çœ‹çŠ¶æ€
4. å°è¯• `python cli_v01.py --reset --yes` é‡ç½®

---

**ä¿®æ”¹å®Œæˆåï¼Œè¯·è¿è¡Œå®Œæ•´æµ‹è¯•éªŒè¯åŠŸèƒ½æ­£å¸¸ï¼** âœ…

