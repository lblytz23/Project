# å¦‚ä½•ä½¿ç”¨é…ç½®æ–‡ä»¶

## ğŸ“‹ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤1: åˆ›å»ºé…ç½®æ–‡ä»¶

```bash
# å¤åˆ¶æ¨¡æ¿
cp config_template.py config.py

# ç¼–è¾‘é…ç½®
nano config.py  # æˆ–ä½¿ç”¨å…¶ä»–ç¼–è¾‘å™¨
```

### æ­¥éª¤2: ä¿®æ”¹é…ç½®

æ‰“å¼€ `config.py`ï¼Œä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š

```python
# æœåŠ¡å™¨é…ç½®ï¼ˆå¿…é¡»ä¿®æ”¹ï¼‰
TOTAL_SERVERS = 2        # æ”¹ä¸ºä½ çš„æœåŠ¡å™¨æ•°é‡
GPUS_PER_SERVER = 4      # æ”¹ä¸ºä½ çš„GPUæ•°é‡
CPUS_PER_SERVER = 32     # æ”¹ä¸ºä½ çš„CPUæ•°é‡
```

### æ­¥éª¤3: éªŒè¯é…ç½®

```bash
python config.py
```

åº”è¯¥çœ‹åˆ°ï¼š
```
é…ç½®æœ‰æ•ˆï¼âœ…
```

### æ­¥éª¤4: ä½¿ç”¨é…ç½®

#### æ–¹æ³•A: ä¿®æ”¹ç°æœ‰ä»£ç ï¼ˆæ¨èï¼‰

åœ¨ `gpu_resource_manager_v01.py` å¼€å¤´æ·»åŠ ï¼š

```python
# å°è¯•å¯¼å…¥é…ç½®æ–‡ä»¶
try:
    from config import *
except ImportError:
    # ä½¿ç”¨é»˜è®¤é…ç½®
    TOTAL_SERVERS = 4
    GPUS_PER_SERVER = 8
    CPUS_PER_SERVER = 64
    RESOURCE_FILE = "resource_status.json"
    LOCK_FILE = ".resource.lock"
```

#### æ–¹æ³•B: åˆ›å»ºæ–°çš„é€‚é…å™¨ï¼ˆæ›´çµæ´»ï¼‰

åˆ›å»º `gpu_manager_with_config.py`:

```python
"""
ä½¿ç”¨é…ç½®æ–‡ä»¶çš„GPUèµ„æºç®¡ç†å™¨
"""

# å¯¼å…¥é…ç½®
from config import *
from gpu_resource_manager_v01 import GPUResourceManagerV01

# ä¿®æ”¹ç±»å±æ€§
GPUResourceManagerV01.TOTAL_SERVERS = TOTAL_SERVERS
GPUResourceManagerV01.GPUS_PER_SERVER = GPUS_PER_SERVER
GPUResourceManagerV01.CPUS_PER_SERVER = CPUS_PER_SERVER
GPUResourceManagerV01.RESOURCE_FILE = RESOURCE_FILE
GPUResourceManagerV01.LOCK_FILE = LOCK_FILE

# å¯¼å‡º
__all__ = ['GPUResourceManagerV01']

if __name__ == "__main__":
    print("é…ç½®å·²åŠ è½½:")
    show_config()
    
    print("\nåˆå§‹åŒ–ç®¡ç†å™¨...")
    manager = GPUResourceManagerV01()
    
    print("æŸ¥çœ‹çŠ¶æ€...")
    summary = manager.get_resource_summary()
    print(f"æ€»GPUæ•°: {summary['total_gpus']}")
    print(f"æ€»CPUæ•°: {summary['total_cpus']}")
```

ç„¶åä½¿ç”¨ï¼š

```python
# åœ¨ä½ çš„ä»£ç ä¸­
from gpu_manager_with_config import GPUResourceManagerV01

manager = GPUResourceManagerV01()
```

---

## ğŸ¯ é…ç½®ç¤ºä¾‹

### ç¤ºä¾‹1: å°å‹å®éªŒå®¤

```python
# config.py

# 2å°æœåŠ¡å™¨ï¼Œæ¯å°4ä¸ªGPU
TOTAL_SERVERS = 2
GPUS_PER_SERVER = 4
CPUS_PER_SERVER = 32

# ä½¿ç”¨å®éªŒå®¤å‘½å
def get_server_name(server_id):
    return f"lab-node-{server_id + 1}"

# å…è®¸å•GPUä»»åŠ¡
MIN_GPUS = 1
MAX_GPUS = 4
```

### ç¤ºä¾‹2: ä¼ä¸šç¯å¢ƒ

```python
# config.py

# 8å°é«˜æ€§èƒ½æœåŠ¡å™¨
TOTAL_SERVERS = 8
GPUS_PER_SERVER = 8
CPUS_PER_SERVER = 128

# ä½¿ç”¨å›ºå®šç›®å½•
import os
DATA_DIR = "/opt/gpu_manager/data"
RESOURCE_FILE = os.path.join(DATA_DIR, "resource_status.json")
LOCK_FILE = os.path.join(DATA_DIR, ".resource.lock")

# ä½¿ç”¨å®é™…ä¸»æœºå
def get_server_name(server_id):
    return f"prod-gpu-{server_id + 1:02d}"

# ä¸¥æ ¼é™åˆ¶
MIN_GPUS = 2
MAX_GPUS = 8
```

### ç¤ºä¾‹3: æ··åˆé…ç½®

```python
# config.py

# ä½¿ç”¨è‡ªå®šä¹‰æœåŠ¡å™¨é…ç½®
TOTAL_SERVERS = 4

CUSTOM_SERVERS = [
    {"id": 0, "name": "training-gpu-01", "gpus": 8, "cpus": 128},
    {"id": 1, "name": "training-gpu-02", "gpus": 8, "cpus": 128},
    {"id": 2, "name": "dev-gpu-01",     "gpus": 4, "cpus": 64},
    {"id": 3, "name": "test-gpu-01",    "gpus": 2, "cpus": 32},
]
```

---

## âœ… éªŒè¯æ¸…å•

é…ç½®å®Œæˆåï¼Œæ£€æŸ¥ï¼š

```bash
# 1. éªŒè¯é…ç½®æ–‡ä»¶
python config.py

# 2. åˆå§‹åŒ–ç³»ç»Ÿ
python cli_v01.py --reset --yes

# 3. æŸ¥çœ‹é…ç½®æ˜¯å¦æ­£ç¡®
python cli_v01.py --status

# 4. æµ‹è¯•åˆ†é…
python cli_v01.py --allocate test_001 2 16

# 5. éªŒè¯çŠ¶æ€
python cli_v01.py --detail

# 6. æ¸…ç†
python cli_v01.py --release test_001
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q: ImportError: No module named 'config'

**A**: ç¡®ä¿ `config.py` å’Œä½ çš„è„šæœ¬åœ¨åŒä¸€ç›®å½•ï¼Œæˆ–è€…åœ¨Pythonè·¯å¾„ä¸­ã€‚

### Q: ä¿®æ”¹é…ç½®åæ²¡æœ‰ç”Ÿæ•ˆï¼Ÿ

**A**: éœ€è¦é‡ç½®ç³»ç»Ÿï¼š
```bash
python cli_v01.py --reset --yes
```

### Q: Windowsä¸Šçš„é”é”™è¯¯ï¼Ÿ

**A**: ä¿®æ”¹ config.py:
```python
LOCK_TYPE = 'filelock'
```

ç„¶åå®‰è£…ï¼š
```bash
pip install filelock
```

---

## ğŸ“ å®Œæ•´å·¥ä½œæµç¨‹

```bash
# 1. å¤åˆ¶é…ç½®æ¨¡æ¿
cp config_template.py config.py

# 2. ç¼–è¾‘ä½ çš„é…ç½®
vim config.py

# 3. éªŒè¯é…ç½®
python config.py

# 4. é‡ç½®ç³»ç»Ÿï¼ˆåº”ç”¨æ–°é…ç½®ï¼‰
python cli_v01.py --reset --yes

# 5. éªŒè¯
python cli_v01.py --status

# 6. å¼€å§‹ä½¿ç”¨
python cli_v01.py --allocate my_task 4 32
```

---

**æç¤º**: é…ç½®æ–‡ä»¶è®©ä½ å¯ä»¥è½»æ¾ç®¡ç†ä¸åŒç¯å¢ƒçš„é…ç½®ï¼Œè€Œæ— éœ€ä¿®æ”¹æºä»£ç ï¼

